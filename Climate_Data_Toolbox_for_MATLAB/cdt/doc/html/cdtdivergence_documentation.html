
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>cdtdivergence documentation</title><meta name="generator" content="MATLAB 9.5"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-01-24"><meta name="DC.source" content="cdtdivergence_documentation.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1><tt>cdtdivergence</tt> documentation</h1><!--introduction--><p><tt>cdtdivergence</tt> calculates the divergence of gridded vectors on the ellipsoidal Earth's surface.</p><p>See also: <a href="cdtgradient_documentation.html"><tt>cdtgradient</tt></a>, <a href="cdtcurl_documentation.html"><tt>cdtcurl</tt></a> and <a href="ekman_documentation.html"><tt>ekman</tt></a>.</p><p><a href="CDT_Contents.html">Back to Climate Data Tools Contents</a>.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Syntax</a></li><li><a href="#2">Description</a></li><li><a href="#3">Example 1: Theory</a></li><li><a href="#10">Example 2: Reality and the ITCZ</a></li><li><a href="#15">Author Info</a></li></ul></div><h2 id="1">Syntax</h2><pre>D = cdtdivergence(lat,lon,U,V)</pre><h2 id="2">Description</h2><p><tt>D = cdtdivergence(lat,lon,U,V)</tt> uses <a href="cdtdim_documentation.html"><tt>cdtdim</tt></a> to estimate the dimensions of each grid cell in the <tt>lat,lon</tt> grid, then computes the divergence of the gridded vectors <tt>U,V</tt>. Units of D are the units of U and V divided by meters.</p><h2 id="3">Example 1: Theory</h2><p>Here's a simple field of purely zonal wind with a uniform velocity of 1 m/s everywhere around the globe. Use <a href="cdtgrid_documentation.html"><tt>cdtgrid</tt></a> to make a quarter-degree grid and then define the wind field:</p><pre class="codeinput">[lat,lon] = cdtgrid(0.25); <span class="comment">% quarter degree grid</span>
u = ones(size(lat));       <span class="comment">% purely zonal wind</span>
v = zeros(size(lat));      <span class="comment">% no meridional component.</span>
</pre><p>Here's what the wind vectors and divergence look like for a purely zonal wind of uniform velocity:</p><pre class="codeinput">D = cdtdivergence(lat,lon,u,v);

figure
imagescn(lon,lat,D)
hold <span class="string">on</span>
borders(<span class="string">'countries'</span>,<span class="string">'color'</span>,rgb(<span class="string">'gray'</span>))
quiversc(lon,lat,u,v,<span class="string">'k'</span>)
cb = colorbar;
ylabel(cb,<span class="string">'divergence (s^{-1})'</span>)
cmocean(<span class="string">'balance'</span>,<span class="string">'pivot'</span>)
</pre><img vspace="5" hspace="5" src="cdtdivergence_documentation_01.png" alt=""> <p>In the figure above, we see that the divergence is zero everywhere. That's because as a parcel of air moves from one grid cell eastward to the next grid cell over, the wind does not change speed or direction, and the neighboring grid cell is exactly the same size as the grid cell it just came from. Everything stays perfectly the same, so there is no divergence.</p><p>What about a purely meridional wind? Can we expect the same kind of zero divergence everywhere around the globe?</p><p>Using the same quarter degree lat,lon grid from above, define a purely meridional wind of uniform velocity everywhere:</p><pre class="codeinput">u = zeros(size(lat)); <span class="comment">% no zonal component</span>
v = ones(size(lat));  <span class="comment">% 1 m/s northward everywhere</span>

<span class="comment">% compute the divergence:</span>
D = cdtdivergence(lat,lon,u,v);

figure
imagescn(lon,lat,D)
hold <span class="string">on</span>
borders(<span class="string">'countries'</span>,<span class="string">'color'</span>,rgb(<span class="string">'gray'</span>))
quiversc(lon,lat,u,v,<span class="string">'k'</span>)
cb = colorbar;
ylabel(cb,<span class="string">'divergence (s^{-1})'</span>)
cmocean(<span class="string">'balance'</span>,<span class="string">'pivot'</span>)
</pre><img vspace="5" hspace="5" src="cdtdivergence_documentation_02.png" alt=""> <p>Above, what we get is <i>not</i> zero divergence everywhere. Rather, there seems to be divergence in the northern hemisphere and convergence in the southern hemisphere. That's because the Earth is not a perfect sphere, but is an ellipsoid whose lines of latitude are spaced at near-but-not-quite-equal distances from each other. Play around with the <a href="earth_radius.html"><tt>earth_radius</tt></a> function, and you'll see that in a trip from the South Pole to the equator, lines of latitude get closer together. Keeping going, and from the equator to the North Pole the lines of latitude will begin to spread apart again. Check the scale on the colorbar above, and you'll see that while latitude spacing does affect divergence, its role here is still quite small.</p><p>Putting together the two examples above, what if the wind is uniform zonally and meridionally everywhere?</p><pre class="codeinput">u = ones(size(lat));
v = ones(size(lat));

D = cdtdivergence(lat,lon,u,v);

figure
imagescn(lon,lat,D)
hold <span class="string">on</span>
borders(<span class="string">'countries'</span>,<span class="string">'color'</span>,rgb(<span class="string">'gray'</span>))
quiversc(lon,lat,u,v,<span class="string">'k'</span>)
cb = colorbar;
ylabel(cb,<span class="string">'divergence (s^{-1})'</span>)
cmocean(<span class="string">'balance'</span>,<span class="string">'pivot'</span>)
</pre><img vspace="5" hspace="5" src="cdtdivergence_documentation_03.png" alt=""> <p>Above we see that adding zero zonal divergence to a small amount of meridional divergence produces the same result as just looking at the meridional divergence. I suppose that's no big surprise.</p><p>Now consider a case where wind speed varies with longitude. Make it</p><pre class="codeinput">u = lon.^2;
v = zeros(size(lat));

D = cdtdivergence(lat,lon,u,v);

figure
imagescn(lon,lat,D)
hold <span class="string">on</span>
borders(<span class="string">'countries'</span>,<span class="string">'color'</span>,rgb(<span class="string">'gray'</span>))
quiversc(lon,lat,u,v,<span class="string">'k'</span>)
cb = colorbar;
ylabel(cb,<span class="string">'divergence (s^{-1})'</span>)
cmocean(<span class="string">'balance'</span>,<span class="string">'pivot'</span>)

caxis([-1 1]*1e-2)
</pre><img vspace="5" hspace="5" src="cdtdivergence_documentation_04.png" alt=""> <p>Above, in the Western Hemisphere the wind converges as it goes from very strong at the international date line, to zero velocity at the prime meridian. There, at the prime meridian, the wind begins to pick up speed again, making it divergent as the wind begins to effectively pull itself apart.</p><p>Also note in the map above that the magnitude of convergence and divergene intensifies close to the poles because at high latitudes the wind accelerations from one grid cell to the next occur over a smaller distance. If you're curious about how grid cell spacing varies around the world, explore the effect with the <a href="cdtdim_documentation.html"><tt>cdtdim</tt></a> function.</p><h2 id="10">Example 2: Reality and the ITCZ</h2><p>For this example load some global surface wind data that comes with CDT. Load the 10-meter wind speeds <tt>u10</tt> and <tt>v10</tt>, and keep it simple by just taking the mean surface winds for 2017:</p><pre class="codeinput">filename = <span class="string">'ERA_Interim_2017.nc'</span>;
u10 = mean(ncread(filename,<span class="string">'u10'</span>),3);
v10 = mean(ncread(filename,<span class="string">'v10'</span>),3);
lat = double(ncread(filename,<span class="string">'latitude'</span>));
lon = double(ncread(filename,<span class="string">'longitude'</span>));
[Lat,Lon] = meshgrid(lat,lon);
</pre><p>The raw data are on a grid that goes from 0 to 360 longitude. I'd rather put the prime meridian in the middle of the map, so let's <a href="recenter_documentation.html"><tt>recenter</tt></a> the grids. This step isn't necessary, but it's a preference:</p><pre class="codeinput">[Lat,Lon,u10,v10] = recenter(Lat,Lon,u10,v10);
</pre><p>Calculating wind divergence is just as simple with real data as it is with the synthetic data we created in Example 1. The only adjustment we'll make here, for aesthetic purposes, is to mask out land grid cells using the <a href="island_documentation.html"><tt>island</tt></a> function:</p><pre class="codeinput"><span class="comment">% Calculate wind divergence:</span>
D = cdtdivergence(Lat,Lon,u10,v10);

<span class="comment">% Mask out land:</span>
land = island(Lat,Lon);
D(land) = NaN;
u10(land) = NaN;
v10(land) = NaN;
</pre><p>Now we can plot wind vectors and their divergence just as in Example 1, but this time we'll start with an <a href="earthimage_documentation.html"><tt>earthimage</tt></a> base map for context:</p><pre class="codeinput">figure
earthimage;
hold <span class="string">on</span>
pcolor(Lon,Lat,D)
shading <span class="string">interp</span>
hold <span class="string">on</span>
quiversc(Lon,Lat,u10,v10,<span class="string">'k'</span>,<span class="string">'density'</span>,100)
cb = colorbar;
ylabel(cb,<span class="string">'surface wind divergence (s^{-1})'</span>)
caxis([-1 1]*1e-5)
cmocean <span class="string">balance</span>
</pre><img vspace="5" hspace="5" src="cdtdivergence_documentation_05.png" alt=""> <p>The map above shows how 10 meter wind vectors converge and diverge around the world. It shows a blue region of convergence just north of the Equator in the eastern Pacific, and that coincides with the Intertropical Convergence Zone (ITCZ), however, the ITCZ is seasonally migratory, so this whole-year average wind field may have the effect of reducing the true intensity of the ITCZ at any given time.</p><h2 id="15">Author Info</h2><p>This function is part of the <a href="http://www.github.com/chadagreene/CDT">Climate Data Toolbox for Matlab</a>. The function and supporting documentation were written by Chad A. Greene of the University of Texas at Austin.</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2018b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% |cdtdivergence| documentation 
% |cdtdivergence| calculates the divergence of gridded vectors on the ellipsoidal
% Earth's surface. 
% 
% See also: <cdtgradient_documentation.html |cdtgradient|>, <cdtcurl_documentation.html |cdtcurl|>
% and <ekman_documentation.html |ekman|>.
% 
% <CDT_Contents.html Back to Climate Data Tools Contents>.
%% Syntax 
% 
%  D = cdtdivergence(lat,lon,U,V)
% 
%% Description
% 
% |D = cdtdivergence(lat,lon,U,V)| uses <cdtdim_documentation.html |cdtdim|> to estimate the 
% dimensions of each grid cell in the |lat,lon| grid, then computes the divergence of the 
% gridded vectors |U,V|. Units of D are the units of U and V divided by meters. 
%
%% Example 1: Theory 
% Here's a simple field of purely zonal wind with a uniform velocity of 1 m/s
% everywhere around the globe. Use <cdtgrid_documentation.html |cdtgrid|>
% to make a quarter-degree grid and then define the wind field: 

[lat,lon] = cdtgrid(0.25); % quarter degree grid
u = ones(size(lat));       % purely zonal wind
v = zeros(size(lat));      % no meridional component. 

%% 
% Here's what the wind vectors and divergence look like for a purely zonal
% wind of uniform velocity: 

D = cdtdivergence(lat,lon,u,v); 

figure
imagescn(lon,lat,D)
hold on 
borders('countries','color',rgb('gray'))
quiversc(lon,lat,u,v,'k')
cb = colorbar; 
ylabel(cb,'divergence (s^{-1})')
cmocean('balance','pivot')

%% 
% In the figure above, we see that the divergence is zero everywhere.
% That's because as a parcel of air moves from one grid cell eastward to
% the next grid cell over, the wind does not change speed or direction, and
% the neighboring grid cell is exactly the same size as the grid cell it
% just came from. Everything stays perfectly the same, so there is no
% divergence. 
% 
% What about a purely meridional wind? Can we expect the same kind of zero
% divergence everywhere around the globe? 
% 
% Using the same quarter degree lat,lon grid from above, define a purely
% meridional wind of uniform velocity everywhere: 

u = zeros(size(lat)); % no zonal component
v = ones(size(lat));  % 1 m/s northward everywhere

% compute the divergence: 
D = cdtdivergence(lat,lon,u,v); 

figure
imagescn(lon,lat,D)
hold on 
borders('countries','color',rgb('gray'))
quiversc(lon,lat,u,v,'k')
cb = colorbar; 
ylabel(cb,'divergence (s^{-1})')
cmocean('balance','pivot')

%% 
% Above, what we get is _not_ zero divergence everywhere. Rather, there
% seems to be divergence in the northern hemisphere and convergence in the
% southern hemisphere. That's because the Earth is not a perfect sphere, but
% is an ellipsoid whose lines of latitude are spaced at near-but-not-quite-equal 
% distances from each other. Play around with the <earth_radius.html |earth_radius|> 
% function, and you'll see that in a trip from the South Pole to the
% equator, lines of latitude get closer together. Keeping going, and from
% the equator to the North Pole the lines of latitude will begin to spread
% apart again. Check the scale on the colorbar above, and you'll see that
% while latitude spacing does affect divergence, its role here is still
% quite small. 

%% 
% Putting together the two examples above, what if the wind is uniform
% zonally and meridionally everywhere? 

u = ones(size(lat)); 
v = ones(size(lat)); 

D = cdtdivergence(lat,lon,u,v); 

figure
imagescn(lon,lat,D)
hold on 
borders('countries','color',rgb('gray'))
quiversc(lon,lat,u,v,'k')
cb = colorbar; 
ylabel(cb,'divergence (s^{-1})')
cmocean('balance','pivot')

%%
% Above we see that adding zero zonal divergence to a small amount of
% meridional divergence produces the same result as just looking at the
% meridional divergence. I suppose that's no big surprise. 
% 
% Now consider a case where wind speed varies with longitude. Make it 

u = lon.^2; 
v = zeros(size(lat)); 

D = cdtdivergence(lat,lon,u,v); 

figure
imagescn(lon,lat,D)
hold on 
borders('countries','color',rgb('gray'))
quiversc(lon,lat,u,v,'k')
cb = colorbar; 
ylabel(cb,'divergence (s^{-1})')
cmocean('balance','pivot')

caxis([-1 1]*1e-2)

%% 
% Above, in the Western Hemisphere the wind converges as it goes from
% very strong at the international date line, to zero velocity at the prime
% meridian. There, at the prime meridian, the wind begins to pick up speed
% again, making it divergent as the wind begins to effectively pull itself
% apart. 
% 
% Also note in the map above that the magnitude of convergence and
% divergene intensifies close to the poles because at high latitudes the
% wind accelerations from one grid cell to the next occur over a smaller
% distance. If you're curious about how grid cell spacing varies around the
% world, explore the effect with the <cdtdim_documentation.html |cdtdim|>
% function. 

%% Example 2: Reality and the ITCZ
% For this example load some global surface wind data that comes with CDT. 
% Load the 10-meter wind speeds |u10| and |v10|, and keep it simple by just
% taking the mean surface winds for 2017:

filename = 'ERA_Interim_2017.nc';
u10 = mean(ncread(filename,'u10'),3);
v10 = mean(ncread(filename,'v10'),3);
lat = double(ncread(filename,'latitude'));
lon = double(ncread(filename,'longitude'));
[Lat,Lon] = meshgrid(lat,lon);

%%
% The raw data are on a grid that goes from 0 to 360 longitude. I'd rather put the prime
% meridian in the middle of the map, so let's <recenter_documentation.html |recenter|> the 
% grids. This step isn't necessary, but it's a preference: 

[Lat,Lon,u10,v10] = recenter(Lat,Lon,u10,v10); 

%%
% Calculating wind divergence is just as simple with real data as it is
% with the synthetic data we created in Example 1. The only adjustment
% we'll make here, for aesthetic purposes, is to mask out land grid cells
% using the <island_documentation.html |island|> function: 

% Calculate wind divergence: 
D = cdtdivergence(Lat,Lon,u10,v10); 

% Mask out land: 
land = island(Lat,Lon); 
D(land) = NaN; 
u10(land) = NaN; 
v10(land) = NaN; 

%%
% Now we can plot wind vectors and their divergence just as in Example 1,
% but this time we'll start with an <earthimage_documentation.html
% |earthimage|> base map for context: 

figure
earthimage;
hold on
pcolor(Lon,Lat,D)
shading interp
hold on 
quiversc(Lon,Lat,u10,v10,'k','density',100)
cb = colorbar; 
ylabel(cb,'surface wind divergence (s^{-1})')
caxis([-1 1]*1e-5)
cmocean balance

%% 
% The map above shows how 10 meter wind vectors converge and diverge around
% the world. It shows a blue region of convergence just north of the
% Equator in the eastern Pacific, and that coincides with the Intertropical 
% Convergence Zone (ITCZ), however, the ITCZ is seasonally migratory, so
% this whole-year average wind field may have the effect of reducing the
% true intensity of the ITCZ at any given time. 

%% Author Info
% This function is part of the <http://www.github.com/chadagreene/CDT Climate Data Toolbox for Matlab>.
% The function and supporting documentation were written by Chad A. Greene
% of the University of Texas at Austin. 

##### SOURCE END #####
--></body></html>